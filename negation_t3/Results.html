{{ block content }}
{{if player.round_number <= 1}}
<h1>Practice Round - Result</h1>
{{else}}
    <h1>Round {{player.play_round_number}} - Result</h1>
{{endif}}
<br>
<h6>
    In this round, the valid actions are <b style="color: green">{{valid_actions}}</b>. <br>
    Action <b style="color: orange">{{group.action}}</b> was chosen, which yields reward <b>{{group.reward}}</b> points to both players. <br>
    {{if group.message == ""}}<b style="color: blue">No message</b>{{else}}The message <b style="color: blue">{{group.message}}</b>{{endif}} was sent and cost <b>{{group.message_cost}}</b> points.<br><br>
    <b>You and your partner both get {{group.reward}} - {{group.message_cost}} = {{player.payoff}} points for this round.</b>
</h6>
<br><br>
<div class = "row">
    <div class = column1>
        <h3>Sender</h3>
        <br>
        <h4>Observed Available Actions: <b>{{sender_actions}}</b></h4>
        <br>
        <h4>Valid actions in this round: <b style="color: green">{{valid_actions}}</b></h4>
        <h4><b>Reminder</b>: the valid actions are always available to the Receiver.</h4>
        <br>
        <h4>Sender's message: {{if group.message == ""}}<b style="color: blue">No message</b> {{else}} <b style="color: blue">{{group.message}}</b>{{endif}}</h4>
        <h4>Total cost: {{group.message_cost}} points</h4>
        <br>
        <hr>
        <br>
        <h4>Symbols to compose your message:</h4>
        <div id="buttons">
        </div><br>
        <h4>Cost: {{C.COST}} points per symbol (First one is free)</h4>
    </div>
    <div class="divider"></div>
    <div class = column1>
        <h3>Receiver</h3>
        <br>
        <h4>Actions available: <b>{{receiver_actions}}</b></h4>
        <br>
        <h4>Receiver's action: <b style="color: orange">{{group.action}}</b></h4>
        <br>
        <h4>Possible rewards:</h4>
        <center>
        <table class="table">
            <colgroup>
                <col style="width: 35%;">   <!-- Action column -->
                <col style="width: 35%;">   <!-- If valid column -->
                <col style="width: 30%;">   <!-- If invalid column -->
            </colgroup>
            <tr>
                <td style="font-weight: bold">Action</td>
                <td style="font-weight: bold">If valid</td>
                <td style="font-weight: bold">If invalid</td>
            </tr>
            {% for letter, reward in action_reward_pairs %}
    <tr>
        <!-- Action cell -->
        <td {% if group.action == letter %}style="background-color: orange;"{% endif %}>
            <button type="button" class="action-button"
                    data-letter="{{ letter }}"
                    id="action-button"
                    {% if group.action == letter %}style="background-color: orange;"{% endif %}>
                {{ letter }}
            </button>
        </td>

        <!-- If valid -->
        <td {% if letter in valid_actions and group.action == letter %}
                style="background-color: green; color: white;"
            {% endif %}>
            {{ reward }}
        </td>

        <!-- If invalid -->
        <td {% if letter not in valid_actions and group.action == letter %}
                style="background-color: red;"
            {% endif %}>
            {{ C.INVALID_REWARD }}
        </td>
    </tr>
    {% endfor %}
        </table>
            </center>
    </div>
</div>
<center><button style="font-size: 20px">Next Round</button></center>

<hr>
<h3>Facts:</h3>
<h4>Probability that the Sender's observed available actions matches the Receiver's available actions: {{player.prob_align_actions}}</h4>
<h4>Probability of 5 valid actions: {{player.prob_5}}</h4>
<h4>Probability of 2 valid actions: {{prob_2}}</h4>
{{ endblock }}


{% block app_styles %}
<style>
    h1 {
        font-size: 35px;
        text-align: center;
        font-weight: bold;
        text-decoration: underline;
    }
    h2 {
        font-size: 25px;
        font-weight: bold;
    }
    h3 {
        font-size: 25px;
        font-weight: bold;
        text-align: center;
        text-decoration: underline;
    }
    h4 {
        font-size: 20px;
    }
    h5 {
        font-size: 25px;
        color: red;
    }
    h6 {
        font-size: 25px;
        text-align: center;
    }
    .column1{
        float: left;
        width: 46%;
        padding: 5px;
        height: 650px;
        font-size: 15px;
    }
    .row:after {
        content: "";
        display: table;
        clear: both;
    }
    .divider {
    float: left;
    width: 1px;
    border-left: 1px solid black;    /* color of the line */
    height: 600px;              /* match .column1 height */
    margin: 0 10px;             /* optional spacing around the line */
}
    td {
        border: 1px solid black;
        font-size: 20px;
        text-align: center;
        vertical-align: middle;
    }
    hr {
      border:none;
      border-top:3px dashed black;
      color:#fff;
      background-color:#fff;
      height:1px;
    }
    .letter-button {
        width: 40px;
        height: 40px;
        margin: 4px;
        font-size: 18px;
        font-weight: bold;
        border-color: white;
    }
    #action-button {
        width: 35px;
        height: 35px;
        font-size: 18px;
        font-weight: bold;
    }
</style>
{%endblock%}

{% block scripts %}
<script>
  letters = ['%', '#', 'a','b','c','d','e','f','g','h','j','k','l','m']
  const buttonsDiv = document.getElementById('buttons');

  // Create buttons dynamically
  if (buttonsDiv) {
      letters.forEach(letter => {
        const btn = document.createElement('button');
        btn.innerText = letter;
        btn.className = 'letter-button';
        btn.type = 'button'; // prevents form submission
        buttonsDiv.appendChild(btn);
      });
  }
</script>

{{endblock}}


