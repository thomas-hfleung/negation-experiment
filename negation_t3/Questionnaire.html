{{ block content }}
<h1>Questionnaire</h1>
<br>
<h3>{{ formfield "Q_gender" }}</h3>
{{ formfield 'Q_gender_other' label=" " }}
<h3>{{ formfield "Q_native_lang" }}</h3><br>
<h3>{{ formfield "Q_year" }}</h3>
{{ formfield 'Q_year_other' label=" " }}
<h4>4. What is your major (select all that apply)?</h4>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_busi">
    <label class="form-check-label">
    Business
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_econ">
    <label class="form-check-label">
    Economics
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_eng">
    <label class="form-check-label">
    Engineering
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_hum">
    <label class="form-check-label">
    Humanities
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_sci">
    <label class="form-check-label">
    Science
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_sosci">
    <label class="form-check-label">
    Social Science
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_undeclared">
    <label class="form-check-label">
    Undeclared
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_prefer_not">
    <label class="form-check-label">
    Prefer not to answer
    </label>
</div>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="True" name="Q_major_other_option">
    <label class="form-check-label">
    Other (Please specify)
    </label>
    {{ formfield 'Q_major_other' label=" " }}
</div>


<div id="major-warning" style="color:red; display:none; margin-top:8px; font-size: 20px; font-weight: bold">
  Please select at least one option.
</div>
<br>
{{if player.type == "Sender"}}
    {{ formfield 'Q_sender_strategy'}}
{{else}}
    {{ formfield 'Q_receiver_strategy'}}
{{endif}}
<br>
{{ formfield 'Q_comments'}}
<br>
<button>Next</button>
{{ endblock }}

{% block app_styles %}
<style>
    h1 {
        font-size: 35px;
        text-align: center;
        font-weight: bold;
        text-decoration: underline;
    }
    h3 {
        font-size: 20px;
    }
    h4 {
        font-size: 25px;
        font-weight: bold;
    }
    p {
        font-size: 20px;
    }
    .form-check-label {
        font-size: 20px;
    }
    textarea {
        height: 170px; /* Makes the boxes taller */
        width: 60vw;      /* Makes the boxes span the full width of the container */
        font-size: 18px;   /* Makes the text inside easier to read */
        padding: 10px;     /* Adds space between the text and the border */
        border: 2px solid #ccc;
        border-radius: 5px;
    }

</style>
{%endblock%}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll("[name$='_other']").forEach(el => {
        el.closest("div")?.style?.setProperty("display", "none");
    });
    // List all your field base names
    const questionPrefixes = [
        "Q_gender",
        "Q_native_lang",
        "Q_year",
        "Q_major"
    ];

    questionPrefixes.forEach(prefix => {
        const radios = document.getElementsByName(prefix);
        const otherInput = document.querySelector(`[name='${prefix}_other']`);

        if (!radios || !otherInput) return;

        // Hide the "Other" text box initially
        otherInput.closest("div")?.style?.setProperty("display", "none");

        // Add listener for radio change
        radios.forEach(radio => {
            radio.addEventListener("change", () => {
                // Find the "Other" radio â€” assume its value is the one for "Other"
                // You can adjust if needed (e.g., if you want to check radio.value === '6')
                const otherSelected = (
                    radio.checked && radio.labels[0].textContent.includes("Other")
                );

                if (otherSelected) {
                    otherInput.closest("div")?.style?.setProperty("display", "block");
                    otherInput.required = true;
                } else {
                    otherInput.closest("div")?.setAttribute("style", "display:none;");
                    otherInput.required = false;
                    otherInput.value = "";
                }
            });
        });
    });
    function getWrapper(el) {
        if (!el) return null;
        return el.closest("div.form-group") || el.closest("div") || el.parentElement;
    }

    function wireCheckboxOther(checkboxName, otherFieldName) {
        const checkbox = document.querySelector(`input[name='${checkboxName}']`);
        const otherInput = document.querySelector(`[name='${otherFieldName}']`);
        if (!checkbox || !otherInput) return;

        function update() {
            const wrapper = getWrapper(otherInput);
            if (checkbox.checked) {
                if (wrapper) wrapper.style.display = "block";
                otherInput.required = true;
            } else {
                if (wrapper) wrapper.style.display = "none";
                otherInput.required = false;
                otherInput.value = "";
            }
        }
        checkbox.addEventListener("change", update);
        update();
    }
    wireCheckboxOther("Q_major_other_option", "Q_major_other");


    const checkboxes = document.querySelectorAll('input[name^="Q_major_"]');
    const form = document.getElementById('form');  // oTree gives the main form this id
    const major_warning = document.getElementById("major-warning");

    form.addEventListener('submit', function(event) {
        const checked = [...checkboxes].some(cb => cb.checked);
        if (!checked) {
            event.preventDefault();
            major_warning.style.display = "block";
        } else {
            major_warning.style.display = "none"; // hide warning if valid
        }
    });
});
</script>
{% endblock %}